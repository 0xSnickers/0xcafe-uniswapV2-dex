# Uniswap V2 é¡¹ç›®ç›®å½•ç»“æ„è¯´æ˜

## ğŸ“ é¡¹ç›®æ¦‚è§ˆ
è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Uniswap V2 DEX (å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€) å­¦ä¹ é¡¹ç›®ï¼ŒåŸºäº Hardhat æ¡†æ¶æ„å»ºã€‚

```
Uniswap_V2/
â”œâ”€â”€ ğŸ“ contracts/                    # æ™ºèƒ½åˆçº¦ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ UniswapV2Factory.sol      # å·¥å‚åˆçº¦ - åˆ›å»ºå’Œç®¡ç†äº¤æ˜“å¯¹
â”‚   â”œâ”€â”€ ğŸ“„ UniswapV2Pair.sol         # äº¤æ˜“å¯¹åˆçº¦ - ç®¡ç†æµåŠ¨æ€§å’Œäº¤æ˜“
â”‚   â”œâ”€â”€ ğŸ“„ UniswapV2ERC20.sol        # ERC20åŸºç¡€åˆçº¦ - LPä»£å¸åŠŸèƒ½
â”‚   â”œâ”€â”€ ğŸ“„ UniswapV2Router02.sol     # è·¯ç”±åˆçº¦ - ç”¨æˆ·äº¤äº’å…¥å£
â”‚   â”œâ”€â”€ ğŸ“„ MockERC20.sol             # æµ‹è¯•ä»£å¸åˆçº¦ - ç”¨äºæ¼”ç¤º
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ interfaces/               # æ¥å£å®šä¹‰ç›®å½•
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ IERC20.sol           # ERC20æ ‡å‡†æ¥å£
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ IUniswapV2Factory.sol # å·¥å‚åˆçº¦æ¥å£
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ IUniswapV2Pair.sol   # äº¤æ˜“å¯¹åˆçº¦æ¥å£
â”‚   â”‚   â””â”€â”€ ğŸ“„ IUniswapV2Callee.sol # å›è°ƒæ¥å£ - é—ªç”µè´·ç­‰åŠŸèƒ½
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ libraries/                # å·¥å…·åº“ç›®å½•
â”‚       â”œâ”€â”€ ğŸ“„ SafeMath.sol         # å®‰å…¨æ•°å­¦åº“ (0.5.16ç‰ˆæœ¬)
â”‚       â”œâ”€â”€ ğŸ“„ SafeMath6.sol        # å®‰å…¨æ•°å­¦åº“ (0.6.6ç‰ˆæœ¬)
â”‚       â”œâ”€â”€ ğŸ“„ UQ112x112.sol        # å›ºå®šç‚¹æ•°å­¦åº“ - ä»·æ ¼ç´¯ç§¯
â”‚       â”œâ”€â”€ ğŸ“„ Math.sol             # æ•°å­¦è¿ç®—åº“ - å¼€æ–¹ç­‰åŠŸèƒ½
â”‚       â””â”€â”€ ğŸ“„ UniswapV2Library.sol # Uniswapå·¥å…·åº“ - åœ°å€è®¡ç®—ç­‰
â”‚
â”œâ”€â”€ ğŸ“ scripts/                      # è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ deploy.ts                # éƒ¨ç½²è„šæœ¬ - éƒ¨ç½²æ‰€æœ‰åˆçº¦
â”‚   â”œâ”€â”€ ğŸ“„ interact.ts              # äº¤äº’æ¼”ç¤º - åŸºç¡€åŠŸèƒ½æ¼”ç¤º
â”‚   â”œâ”€â”€ ğŸ“„ priceDemo.ts             # ä»·æ ¼æœºåˆ¶æ¼”ç¤º - AMMå®šä»·åŸç†
â”‚   â”œâ”€â”€ ğŸ“„ swapDemo.ts              # äº¤æ˜“æ¼”ç¤º - swapåŠŸèƒ½æ¼”ç¤º
â”‚   â””â”€â”€ ğŸ“„ getInitCodeHash.ts       # è·å–åˆå§‹åŒ–ä»£ç å“ˆå¸Œ
â”‚
â”œâ”€â”€ ğŸ“ test/                         # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ UniswapV2.test.ts        # ä¸»è¦åŠŸèƒ½æµ‹è¯•
â”‚   â””â”€â”€ ğŸ“„ addLiquidity.test.ts     # æ·»åŠ æµåŠ¨æ€§æµ‹è¯•
â”‚
â”œâ”€â”€ ğŸ“ typechain-types/              # TypeScriptç±»å‹å®šä¹‰ (è‡ªåŠ¨ç”Ÿæˆ)
â”œâ”€â”€ ğŸ“ artifacts/                    # ç¼–è¯‘äº§ç‰© (è‡ªåŠ¨ç”Ÿæˆ)
â”œâ”€â”€ ğŸ“ cache/                        # ç¼–è¯‘ç¼“å­˜ (è‡ªåŠ¨ç”Ÿæˆ)
â”œâ”€â”€ ğŸ“ node_modules/                 # ä¾èµ–åŒ… (è‡ªåŠ¨ç”Ÿæˆ)
â”‚
â”œâ”€â”€ ğŸ“„ hardhat.config.ts             # Hardhaté…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ package.json                  # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ ğŸ“„ package-lock.json             # ä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ ğŸ“„ tsconfig.json                 # TypeScripté…ç½®
â”œâ”€â”€ ğŸ“„ .gitignore                    # Gitå¿½ç•¥æ–‡ä»¶
â””â”€â”€ ğŸ“„ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸ”§ æ ¸å¿ƒåˆçº¦è¯´æ˜

### 1. UniswapV2Factory.sol (å·¥å‚åˆçº¦)
- **ä½œç”¨**: åˆ›å»ºå’Œç®¡ç†æ‰€æœ‰äº¤æ˜“å¯¹
- **ä¸»è¦åŠŸèƒ½**:
  - `createPair()` - åˆ›å»ºæ–°çš„äº¤æ˜“å¯¹
  - `getPair()` - è·å–äº¤æ˜“å¯¹åœ°å€
  - `allPairs()` - è·å–æ‰€æœ‰äº¤æ˜“å¯¹åˆ—è¡¨
- **Solidityç‰ˆæœ¬**: 0.5.16

### 2. UniswapV2Pair.sol (äº¤æ˜“å¯¹åˆçº¦)
- **ä½œç”¨**: ç®¡ç†ç‰¹å®šä»£å¸å¯¹çš„æµåŠ¨æ€§å’Œäº¤æ˜“
- **ä¸»è¦åŠŸèƒ½**:
  - `mint()` - é“¸é€ LPä»£å¸ (æ·»åŠ æµåŠ¨æ€§)
  - `burn()` - é”€æ¯LPä»£å¸ (ç§»é™¤æµåŠ¨æ€§)
  - `swap()` - æ‰§è¡Œä»£å¸äº¤æ¢
  - `getReserves()` - è·å–å‚¨å¤‡é‡
- **Solidityç‰ˆæœ¬**: 0.5.16

### 3. UniswapV2Router02.sol (è·¯ç”±åˆçº¦)
- **ä½œç”¨**: ç”¨æˆ·äº¤äº’çš„ä¸»è¦å…¥å£ï¼Œæä¾›å®‰å…¨çš„äº¤æ˜“æ¥å£
- **ä¸»è¦åŠŸèƒ½**:
  - `addLiquidity()` - å®‰å…¨æ·»åŠ æµåŠ¨æ€§
  - `removeLiquidity()` - å®‰å…¨ç§»é™¤æµåŠ¨æ€§
  - `swapExactTokensForTokens()` - ç²¾ç¡®è¾“å…¥äº¤æ¢
  - `swapTokensForExactTokens()` - ç²¾ç¡®è¾“å‡ºäº¤æ¢
- **Solidityç‰ˆæœ¬**: 0.6.6

### 4. MockERC20.sol (æµ‹è¯•ä»£å¸)
- **ä½œç”¨**: ç”¨äºæµ‹è¯•çš„ERC20ä»£å¸
- **ä¸»è¦åŠŸèƒ½**:
  - `mint()` - é“¸é€ ä»£å¸ (ä»…æµ‹è¯•ç”¨)
  - æ ‡å‡†ERC20åŠŸèƒ½ (transfer, approveç­‰)
- **Solidityç‰ˆæœ¬**: 0.6.6

## ğŸ“š å·¥å…·åº“è¯´æ˜

### SafeMath.sol / SafeMath6.sol
- **ä½œç”¨**: é˜²æ­¢æ•´æ•°æº¢å‡ºçš„å®‰å…¨æ•°å­¦è¿ç®—
- **åŒºåˆ«**: åˆ†åˆ«é€‚é…0.5.16å’Œ0.6.6ç‰ˆæœ¬

### UQ112x112.sol
- **ä½œç”¨**: å›ºå®šç‚¹æ•°å­¦åº“ï¼Œç”¨äºä»·æ ¼ç´¯ç§¯è®¡ç®—
- **ç²¾åº¦**: 112ä½å°æ•°ç²¾åº¦

### Math.sol
- **ä½œç”¨**: åŸºç¡€æ•°å­¦è¿ç®—
- **åŠŸèƒ½**: æœ€å°å€¼æ¯”è¾ƒã€å¹³æ–¹æ ¹è®¡ç®—

### UniswapV2Library.sol
- **ä½œç”¨**: Uniswapä¸“ç”¨å·¥å…·å‡½æ•°
- **åŠŸèƒ½**: åœ°å€è®¡ç®—ã€å‚¨å¤‡é‡æŸ¥è¯¢ã€ä»·æ ¼è®¡ç®—

## ğŸ¯ è„šæœ¬åŠŸèƒ½è¯´æ˜

### 1. interact.ts - åŸºç¡€äº¤äº’æ¼”ç¤º
```bash
npx hardhat run scripts/interact.ts
```
- æ¼”ç¤ºå®Œæ•´çš„DEXä½¿ç”¨æµç¨‹
- éƒ¨ç½²åˆçº¦ â†’ é“¸é€ ä»£å¸ â†’ æ·»åŠ æµåŠ¨æ€§ â†’ æŸ¥çœ‹ç»“æœ

### 2. priceDemo.ts - ä»·æ ¼æœºåˆ¶æ¼”ç¤º
```bash
npx hardhat run scripts/priceDemo.ts
```
- æ¼”ç¤ºAMMè‡ªåŠ¨åšå¸‚å•†å®šä»·åŸç†
- å±•ç¤ºRouterçš„æµåŠ¨æ€§ä¿æŠ¤æœºåˆ¶
- ç†è§£æ’å®šä¹˜ç§¯å…¬å¼ x * y = k

### 3. swapDemo.ts - äº¤æ˜“æ¼”ç¤º
```bash
npx hardhat run scripts/swapDemo.ts
```
- æ¼”ç¤ºä»£å¸äº¤æ¢åŠŸèƒ½
- å±•ç¤ºæ»‘ç‚¹å’Œä»·æ ¼å½±å“
- ç†è§£æ‰‹ç»­è´¹æœºåˆ¶

### 4. deploy.ts - éƒ¨ç½²è„šæœ¬
```bash
npx hardhat run scripts/deploy.ts
```
- éƒ¨ç½²æ‰€æœ‰æ ¸å¿ƒåˆçº¦
- è¾“å‡ºåˆçº¦åœ°å€ç”¨äºåç»­äº¤äº’

## ğŸ§ª æµ‹è¯•è¯´æ˜

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
npx hardhat test
```

### æµ‹è¯•è¦†ç›–
- âœ… äº¤æ˜“å¯¹åˆ›å»º
- âœ… æµåŠ¨æ€§æ·»åŠ 
- âœ… åŸºæœ¬äº¤æ˜“åŠŸèƒ½
- âœ… é”™è¯¯å¤„ç†

## ğŸ”„ å¼€å‘å·¥ä½œæµ

### 1. å®‰è£…ä¾èµ–
```bash
npm install
```

### 2. ç¼–è¯‘åˆçº¦
```bash
npx hardhat compile
```

### 3. è¿è¡Œæµ‹è¯•
```bash
npx hardhat test
```

### 4. è¿è¡Œæ¼”ç¤º
```bash
npx hardhat run scripts/interact.ts
npx hardhat run scripts/priceDemo.ts
```

### 5. å¯åŠ¨æœ¬åœ°ç½‘ç»œ
```bash
npx hardhat node
```

## ğŸ“– å­¦ä¹ è·¯å¾„å»ºè®®

1. **ç¬¬ä¸€æ­¥**: è¿è¡Œ `interact.ts` ç†è§£åŸºæœ¬æµç¨‹
2. **ç¬¬äºŒæ­¥**: è¿è¡Œ `priceDemo.ts` ç†è§£å®šä»·æœºåˆ¶
3. **ç¬¬ä¸‰æ­¥**: é˜…è¯»åˆçº¦ä»£ç ï¼Œç†è§£å®ç°ç»†èŠ‚
4. **ç¬¬å››æ­¥**: ä¿®æ”¹å‚æ•°ï¼Œè§‚å¯Ÿç»“æœå˜åŒ–
5. **ç¬¬äº”æ­¥**: å°è¯•æ·»åŠ æ–°åŠŸèƒ½

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µ

- **AMM (è‡ªåŠ¨åšå¸‚å•†)**: é€šè¿‡ç®—æ³•è‡ªåŠ¨æä¾›æµåŠ¨æ€§
- **æ’å®šä¹˜ç§¯å…¬å¼**: x * y = kï¼Œç¡®ä¿ä»·æ ¼å¹³è¡¡
- **LPä»£å¸**: æµåŠ¨æ€§æä¾›è€…ä»£å¸ï¼Œä»£è¡¨æ± å­ä»½é¢
- **æ»‘ç‚¹**: å¤§é¢äº¤æ˜“å¯¹ä»·æ ¼çš„å½±å“
- **å¥—åˆ©**: åˆ©ç”¨ä»·æ ¼å·®å¼‚è·åˆ©çš„æœºåˆ¶
